<!DOCTYPE html>
<html>
<head>
  <title>Modal Analysis Results</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Center align all table cell text */
    table.table td, table.table th {
      text-align: center;
    }
    /* Color red for frequency diffs <= 300 or NaN */
    .highlight-red {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1>Modal Analysis Results</h1>

    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% else %}
      {% if modal_target %}
        <p><strong>Modal Target: </strong> {{ modal_target }}</p>
      {% endif %}

      {% if result %}
        <div class="table-responsive">
          {{ result | safe }}
        </div>
      {% else %}
        <p>No results to display.</p>
      {% endif %}
    {% endif %}

    <a href="{{ url_for('index') }}" class="btn btn-primary mt-3">Back to Upload</a>
  </div>

  <script>
    // Highlight freq diff cells that are â‰¤ 300 or NaN in red
    document.addEventListener('DOMContentLoaded', function() {
      // Columns header titles to check
      const lowerCol = 'Lower Frequency Diff (Hz)';
      const upperCol = 'Upper Frequency Diff (Hz)';
      const table = document.querySelector('table.table');

      if (!table) return;

      // Get column indexes corresponding to targets
      const headers = Array.from(table.querySelectorAll('thead th'));
      const lowerIdx = headers.findIndex(h => h.textContent.trim() === lowerCol);
      const upperIdx = headers.findIndex(h => h.textContent.trim() === upperCol);

      // Iterate over table rows (tbody)
      table.querySelectorAll('tbody tr').forEach(row => {
        const cells = row.querySelectorAll('td');

        [lowerIdx, upperIdx].forEach(idx => {
          if (idx < 0) return; // column not found
          const val = cells[idx].textContent.trim();
          // Convert to number or NaN
          const num = val === '' || val.toLowerCase() === 'nan' ? NaN : parseFloat(val);
          if (isNaN(num) || num <= 300) {
            cells[idx].classList.add('highlight-red');
          }
        });
      });
    });
  </script>
</body>
</html>
