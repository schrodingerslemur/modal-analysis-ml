<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Brake Rotor Predictor</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="main-container">
      <h5 class="app-title">Brake Rotor Predictor</h5>
      <p class="app-subtitle">
        Upload your rotor data files for modal analysis
      </p>

      <form
        id="uploadForm"
        class="upload-form"
        action="{{ url_for('predict') }}"
        method="POST"
        enctype="multipart/form-data"
      >
        <div class="form-group">
          <label for="dat_file" class="form-label"
            >ğŸ“Š DAT File (Displacements)</label
          >
          <input
            type="file"
            id="dat_file"
            name="dat_file"
            class="file-input"
            accept=".dat"
            required
          />
        </div>

        <div class="form-group">
          <label for="inp_file" class="form-label"
            >ğŸ“ INP File (Positions)</label
          >
          <input
            type="file"
            id="inp_file"
            name="inp_file"
            class="file-input"
            accept=".inp"
          />
        </div>

        <button type="submit" class="submit-btn">ğŸš€ Analyze Rotor Data</button>
      </form>
    </div>

    <!-- Loading overlay hidden initially -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="spinner-container">
        <div class="spinner-icon"></div>
        Processing, please wait...
      </div>
    </div>

    <script>
      const form = document.getElementById("uploadForm");
      const loadingOverlay = document.getElementById("loadingOverlay");
      const submitBtn = document.querySelector(".submit-btn");

      // Add visual feedback for file uploads
      const fileInputs = document.querySelectorAll(".file-input");
      fileInputs.forEach((input) => {
        input.addEventListener("change", function (e) {
          if (this.files.length > 0) {
            this.classList.add("file-selected");
          } else {
            this.classList.remove("file-selected");
          }
        });
      });

      form.addEventListener("submit", function (e) {
        // Show the overlay when form is submitted
        loadingOverlay.style.display = "block";
        submitBtn.disabled = true;
        submitBtn.textContent = "ğŸ”„ Processing...";

        // Add a timeout to re-enable the button if something goes wrong
        setTimeout(() => {
          if (submitBtn.disabled) {
            submitBtn.disabled = false;
            submitBtn.textContent = "ğŸš€ Analyze Rotor Data";
            loadingOverlay.style.display = "none";
          }
        }, 30000); // 30 seconds timeout
      });

      // Add drag and drop functionality
      fileInputs.forEach((input) => {
        ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
          input.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        ["dragenter", "dragover"].forEach((eventName) => {
          input.addEventListener(eventName, () => {
            input.classList.add("drag-over");
          });
        });

        ["dragleave", "drop"].forEach((eventName) => {
          input.addEventListener(eventName, () => {
            input.classList.remove("drag-over");
          });
        });

        input.addEventListener("drop", handleDrop);

        function handleDrop(e) {
          const dt = e.dataTransfer;
          const files = dt.files;
          input.files = files;

          // Trigger change event
          const event = new Event("change", { bubbles: true });
          input.dispatchEvent(event);
        }
      });
    </script>
  </body>
</html>
